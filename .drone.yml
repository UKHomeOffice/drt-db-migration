pipeline:

   build:
     image: quay.io/ukhomeofficedigital/scala-sbt-nodejs
     commands:
       - /root/entrypoint.sh
       - sbt  docker:stage
     environment:
       - ARTIFACTORY_USERNAME=drt_ci
     secrets:
       - ARTIFACTORY_PASSWORD
     when:
       event:
         - push
       branch:
         - docker

         
  build_docker:
    environment:
      - DOCKER_USERNAME=drt_ci
    image: quay.io/ukhomeofficedigital/drone-docker
    registry: docker.digital.homeoffice.gov.uk
    repo: docker.digital.homeoffice.gov.uk/drt-db-migration
    secrets: [ docker_password ]
    tags:
      - ${DRONE_BUILD_NUMBER}
      - latest
    when:
      event: push
      branch: docker
